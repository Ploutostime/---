# 3D秘书 + AI智能对话功能说明

## 功能概述

智学秘伴的专属学习秘书现在支持**真正的3D人物模型**和**AI智能对话**！秘书不再是静态的图片，而是可以交互的3D角色（类似3D蒂法），并且接入了人工智能，能够像真人一样用自然的语言与你对话。

## 核心特性

### 1. 3D人物模型 🎮

**真正的3D角色：**
- 使用Three.js技术渲染的3D人物模型
- 可以旋转查看不同角度
- 具有呼吸动画和待机动画
- 说话时会有动态表情
- 根据形象类型显示不同颜色和风格

**6种形象类型：**
- 🌸 萝莉（小萌）- 粉色系，可爱活泼
- 💐 御姐（优雅姐姐）- 紫色系，成熟优雅
- 🎩 大叔（稳重叔叔）- 蓝色系，稳重可靠
- 👔 霸总（霸道总裁）- 深灰色系，干练高效
- 📚 学姐（温柔学姐）- 天蓝色系，亲切耐心
- ⚡ 学长（阳光学长）- 橙色系，阳光积极

**3D模型特点：**
- 完整的身体结构（头、身体、手臂、腿）
- 真实的3D空间感
- 流畅的动画效果
- 可交互的视角控制
- 优美的光影效果

### 2. AI智能对话 🤖

**人工智能驱动：**
- 接入AI对话引擎
- 根据秘书性格调整对话风格
- 理解上下文，连贯对话
- 自然的人类语言表达
- 智能的情感回应

**对话功能：**
- 实时对话交流
- 对话历史记录
- 自动保存对话
- 支持长对话
- 快速响应

**秘书职责：**
1. **学习管理**
   - 帮助规划学习时间
   - 提醒任务截止日期
   - 建议学习方法
   - 跟踪学习进度

2. **情感支持**
   - 鼓励和打气
   - 关心学习状态
   - 缓解学习压力
   - 提供心理支持

3. **问题解答**
   - 回答学习相关问题
   - 提供建议和指导
   - 分享学习经验
   - 解决困惑

4. **陪伴互动**
   - 日常聊天
   - 分享心情
   - 轻松对话
   - 温暖陪伴

### 3. 性格化对话

每种性格都有独特的对话风格：

**温柔型：**
- 说话柔和，充满关怀
- 用鼓励的语气帮助用户
- 像朋友一样关心学习和生活
- 示例："别担心，我们一起慢慢来，一定可以解决的。"

**严格型：**
- 注重效率和纪律
- 督促按时完成任务
- 对学习要求严格
- 示例："时间很宝贵，我们要高效利用每一分钟。"

**活泼型：**
- 充满趣味和活力
- 用幽默的方式鼓励
- 让学习过程轻松愉快
- 示例："哈哈，这个问题有意思！让我想想~"

**冷静型：**
- 善于分析和规划
- 用逻辑清晰的方式帮助
- 提供专业的学习建议
- 示例："让我分析一下这个问题..."

**激励型：**
- 充满激情，总是打气加油
- 用积极向上的语言激励
- 帮助克服困难
- 示例："太棒了！就是这个状态！"

## 使用方式

### 在仪表盘使用

1. 进入仪表盘页面
2. 查看"秘书的问候"卡片
3. 可以看到秘书的3D人物模型
4. 鼠标拖动可以旋转查看
5. 点击"与秘书对话"按钮
6. 打开AI对话窗口
7. 开始与秘书聊天

### 在浮窗使用

1. 屏幕上会显示浮窗秘书
2. 展开浮窗可以看到3D人物模型
3. 点击"与秘书对话"按钮
4. 打开AI对话窗口
5. 随时随地与秘书交流

### AI对话窗口

**窗口布局：**
```
┌─────────────────────────────┐
│  与 [秘书名] 对话        [X]│
├─────────────────────────────┤
│                             │
│    [3D人物模型显示区]       │
│                             │
├─────────────────────────────┤
│                             │
│  [对话历史记录]             │
│  用户: 你好                 │
│  秘书: 你好呀~有什么需要... │
│                             │
├─────────────────────────────┤
│ [输入框]            [发送]  │
└─────────────────────────────┘
```

**使用技巧：**
- 按回车键快速发送消息
- 对话会自动保存
- 可以随时关闭和重新打开
- 3D模型说话时会有动画

## 技术实现

### 3D渲染技术

**使用的库：**
- Three.js - 3D图形库
- React Three Fiber - React集成
- @react-three/drei - 3D辅助工具

**3D模型构成：**
```typescript
- 身体：胶囊体几何
- 头部：球体几何
- 眼睛：小球体
- 嘴巴：球体（说话时显示）
- 手臂：胶囊体（左右各一）
- 腿：胶囊体（左右各一）
```

**动画效果：**
- 呼吸动画：身体轻微缩放
- 待机动画：轻微左右摇摆
- 说话动画：头部轻微转动，嘴巴显示

**光影系统：**
- 环境光：整体照明
- 方向光：主光源
- 点光源：补充光
- 环境贴图：增强真实感

### AI对话技术

**Edge Function：**
- 函数名：secretary-chat
- 部署在Supabase Edge Functions
- 处理AI对话请求

**对话流程：**
1. 用户发送消息
2. 前端调用Edge Function
3. Edge Function构建对话上下文
4. 调用AI API（或使用模拟回复）
5. 返回AI回复
6. 保存对话历史到数据库
7. 前端显示回复

**性格系统提示词：**
```typescript
const systemPrompt = `
${avatarRoles[avatarType]}  // 形象角色设定
${personalityPrompts[personalityType]}  // 性格特点

你的名字是"${name}"。
你是用户的专属学习秘书，主要职责是：
1. 帮助用户管理学习任务和时间
2. 提供学习建议和鼓励
3. 回答用户的问题
4. 关心用户的学习状态和心情
`;
```

**对话历史管理：**
- 存储在secretary_chat_history表
- 记录用户和秘书的对话
- 支持查询历史对话
- 自动加载最近对话

### 数据库设计

**对话历史表：**
```sql
CREATE TABLE secretary_chat_history (
  id UUID PRIMARY KEY,
  user_id UUID NOT NULL,
  role TEXT NOT NULL,  -- 'user' 或 'assistant'
  content TEXT NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

**RLS策略：**
- 用户只能查看自己的对话
- 用户只能插入自己的对话
- 保护隐私安全

## 性能优化

### 3D渲染优化

**优化措施：**
- 使用简单几何体减少顶点数
- 禁用不必要的阴影
- 限制动画帧率
- 使用OrbitControls限制交互

**性能指标：**
- 60 FPS流畅渲染
- 低CPU占用
- 快速加载
- 流畅动画

### AI对话优化

**优化措施：**
- 限制对话历史长度（最近10条）
- 使用模拟回复作为后备
- 异步处理不阻塞UI
- 错误处理和重试机制

**响应速度：**
- 模拟模式：即时响应
- AI模式：1-3秒响应
- 网络错误自动降级

## 未来规划

### 短期（1-2个月）

1. **更丰富的3D模型**
   - 使用VRM格式的专业模型
   - 更多的动画表情
   - 更细腻的外观
   - 服装可视化

2. **更强大的AI**
   - 接入更先进的AI模型
   - 支持语音对话
   - 情感识别
   - 个性化学习

### 中期（3-6个月）

1. **3D场景扩展**
   - 添加背景场景
   - 互动道具
   - 特效动画
   - 表情系统

2. **AI功能增强**
   - 主动提醒
   - 智能建议
   - 学习分析
   - 进度跟踪

### 长期（6个月以上）

1. **虚拟现实支持**
   - VR/AR体验
   - 沉浸式交互
   - 空间音频
   - 手势控制

2. **社交功能**
   - 秘书分享
   - 对话分享
   - 社区互动
   - 排行榜

## 常见问题

### Q1: 3D模型会很卡吗？

A: 不会。我们使用了优化的简单几何体，性能非常好，即使在低端设备上也能流畅运行。

### Q2: AI对话需要付费吗？

A: 目前提供免费的模拟对话模式，可以正常使用。如果配置了AI API密钥，可以使用更智能的AI对话。

### Q3: 对话历史会保存多久？

A: 对话历史会永久保存在数据库中，你可以随时查看历史对话。

### Q4: 可以自定义3D模型吗？

A: 目前提供6种预设形象，每种形象有不同的颜色和风格。未来会支持更多自定义选项。

### Q5: AI会泄露我的隐私吗？

A: 不会。对话历史只保存在你的账户中，有严格的RLS策略保护。AI对话不会分享给其他用户。

### Q6: 3D模型可以做什么动作？

A: 目前支持呼吸动画、待机动画和说话动画。未来会添加更多动作和表情。

### Q7: 如何切换AI对话模式？

A: 系统会自动检测是否配置了AI API。如果没有配置，会使用模拟模式。模拟模式也能提供很好的对话体验。

### Q8: 可以导出对话记录吗？

A: 目前暂不支持导出，但对话历史会永久保存。未来会添加导出功能。

## 总结

3D秘书 + AI智能对话功能让智学秘伴的专属学习秘书真正"活"了起来！通过真实的3D人物模型和智能的AI对话，秘书不再是冷冰冰的工具，而是一个有温度、能交流、会关心你的学习伙伴。

**核心价值：**
- 🎮 真正的3D人物模型，可交互的角色
- 🤖 AI智能对话，像真人一样交流
- 💬 性格化对话，符合形象特点
- 📚 学习助手，帮助管理和规划
- 💖 情感陪伴，温暖学习过程
- 🎯 随时随地，浮窗和仪表盘都能用

**使用建议：**
- 选择喜欢的形象和性格
- 经常与秘书对话交流
- 分享学习中的困惑和心情
- 让秘书帮助规划学习
- 享受AI陪伴的学习体验

让3D秘书成为你学习路上最智能、最贴心的伙伴！

---

**智学秘伴团队**  
*让学习更有温度，让成长更有陪伴*
