# 浮窗秘书功能详解

## 功能概述

浮窗秘书是智学秘伴的创新功能，让你的专属学习秘书以**可拖动浮窗**的形式出现在屏幕上，随时随地陪伴你的学习过程。无论你在浏览哪个页面，秘书都会在屏幕上为你提供问候、提醒和鼓励。

## 核心特性

### 🎯 智能定位

**默认位置：** 右下角
- 首次使用时，浮窗会自动出现在屏幕右下角
- 位置经过精心设计，不会遮挡主要内容
- 适合大多数用户的使用习惯

**自由拖动：**
- 鼠标按住浮窗标题栏（显示秘书名称的区域）
- 拖动到屏幕上的任意位置
- 拖动时光标会变成"抓取"状态
- 释放鼠标即可固定位置

**边界限制：**
- 浮窗会自动限制在窗口范围内
- 不会被拖出屏幕外
- 确保始终可见和可操作

### 📍 位置记忆

**自动保存：**
- 每次移动浮窗后，位置会自动保存到浏览器本地存储
- 下次打开系统时，浮窗会出现在上次的位置
- 无需重复调整，一次设置永久生效

**跨会话保持：**
- 即使关闭浏览器，位置信息也会保留
- 刷新页面不会丢失位置设置
- 切换页面时浮窗位置保持不变

### 🔄 最小化/展开

**最小化功能：**
- 点击浮窗右上角的最小化按钮（-图标）
- 浮窗会缩小为一个小图标
- 只显示秘书头像和消息提示图标
- 占用空间极小，不影响工作

**展开功能：**
- 点击最小化的图标
- 浮窗会重新展开，显示完整内容
- 展开后可以看到对话气泡和秘书信息
- 最小化状态也会被记住

**状态记忆：**
- 最小化状态会自动保存
- 下次打开时保持上次的状态
- 可以根据需要随时切换

### 💬 实时对话

**对话气泡：**
- 展开状态下显示美观的对话气泡
- 气泡带有尾巴，指向秘书头像
- 背景半透明，视觉效果柔和
- 文字清晰易读，排版舒适

**消息内容：**
- 根据性格类型生成个性化对话
- 包含问候、提醒、鼓励三种类型
- 语言风格符合秘书性格设定
- 内容丰富多样，不会重复

### ⏰ 定时更新

**自动更新：**
- 每分钟自动更新一次消息内容
- 无需手动刷新，保持新鲜感
- 后台自动运行，不影响性能

**智能切换：**
- 根据时间段自动选择消息类型
- 早晨（6:00-12:00）：温暖的问候语
- 下午（12:00-18:00）：任务提醒和督促
- 晚上（18:00-6:00）：鼓励和总结

**任务感知：**
- 自动检测即将到期的任务
- 有任务时显示提醒语
- 无任务时显示鼓励语
- 智能适应学习状态

### 🎨 美观设计

**视觉效果：**
- 渐变背景：从主色到次色的柔和渐变
- 圆角卡片：8px圆角，符合系统设计风格
- 柔和阴影：多层阴影增强立体感
- 半透明背景：backdrop-blur 毛玻璃效果

**交互反馈：**
- 鼠标悬停时显示高亮效果
- 拖动时光标变化提示
- 按钮点击有视觉反馈
- 动画过渡流畅自然

**响应式设计：**
- 适配不同屏幕尺寸
- 在小屏幕上自动调整大小
- 保持最佳显示效果

### 👆 拖动操作

**操作方式：**
1. 鼠标移动到浮窗标题栏
2. 光标会变成"抓取"图标
3. 按住鼠标左键
4. 拖动到目标位置
5. 释放鼠标完成移动

**拖动体验：**
- 流畅的拖动动画
- 实时位置更新
- 边界自动限制
- 释放后自动保存

**注意事项：**
- 只能通过标题栏拖动
- 最小化状态不可拖动
- 拖动时不会触发其他操作

### ❌ 隐藏功能

**关闭浮窗：**
- 点击浮窗右上角的关闭按钮（X图标）
- 浮窗会立即隐藏
- 不影响秘书功能的其他部分
- 仪表盘的秘书卡片仍然显示

**重新显示：**
- 刷新页面
- 在设置页面重新保存配置
- 浮窗会重新出现
- 恢复到上次的位置和状态

**隐藏状态：**
- 隐藏状态会被记住
- 如果主动关闭，下次不会自动显示
- 需要重新保存配置才能显示

## 使用场景

### 场景1：专注学习

**需求：** 学习时需要秘书陪伴，但不能占用太多屏幕空间

**操作：**
1. 将浮窗拖动到屏幕右下角
2. 点击最小化按钮，缩小为图标
3. 秘书会以小图标形式陪伴
4. 需要时点击图标展开查看

**效果：**
- 占用空间极小
- 不影响学习内容浏览
- 随时可以展开查看
- 保持陪伴感

### 场景2：任务提醒

**需求：** 需要秘书及时提醒即将到期的任务

**操作：**
1. 保持浮窗展开状态
2. 将浮窗放在容易看到的位置
3. 秘书会自动检测任务
4. 每分钟更新提醒内容

**效果：**
- 及时收到任务提醒
- 不会错过截止时间
- 提醒语符合秘书性格
- 温和而不打扰

### 场景3：鼓励激励

**需求：** 学习疲惫时需要鼓励和激励

**操作：**
1. 查看浮窗的鼓励语
2. 根据性格类型获得不同风格的鼓励
3. 每分钟自动更新内容
4. 保持学习动力

**效果：**
- 及时的情感支持
- 个性化的鼓励语
- 增强学习动力
- 减轻学习压力

### 场景4：多页面使用

**需求：** 在不同页面间切换时保持秘书陪伴

**操作：**
1. 浮窗会固定在屏幕上
2. 切换页面时浮窗不会消失
3. 位置保持不变
4. 持续提供陪伴

**效果：**
- 全局陪伴
- 无缝切换
- 一致体验
- 随时可见

## 技术实现

### 组件结构

```typescript
FloatingSecretary
├── 状态管理
│   ├── config: 秘书配置
│   ├── isMinimized: 最小化状态
│   ├── isVisible: 可见状态
│   ├── position: 位置坐标
│   ├── isDragging: 拖动状态
│   ├── currentMessage: 当前消息
│   └── messageType: 消息类型
├── 生命周期
│   ├── 加载秘书配置
│   ├── 定时更新消息
│   ├── 加载保存的位置
│   └── 监听拖动事件
└── 渲染
    ├── 最小化视图
    └── 展开视图
```

### 核心功能

**位置管理：**
```typescript
// 保存位置到 localStorage
localStorage.setItem('secretary_position', JSON.stringify(position));

// 加载位置
const savedPosition = localStorage.getItem('secretary_position');
if (savedPosition) {
  setPosition(JSON.parse(savedPosition));
}
```

**拖动实现：**
```typescript
// 鼠标按下
const handleMouseDown = (e: React.MouseEvent) => {
  setIsDragging(true);
  setDragOffset({
    x: e.clientX - position.x,
    y: e.clientY - position.y,
  });
};

// 鼠标移动
const handleMouseMove = (e: MouseEvent) => {
  if (!isDragging) return;
  const newX = e.clientX - dragOffset.x;
  const newY = e.clientY - dragOffset.y;
  setPosition({ x: newX, y: newY });
};
```

**消息更新：**
```typescript
// 定时更新
useEffect(() => {
  updateMessage();
  const interval = setInterval(() => {
    updateMessage();
  }, 60000); // 每分钟
  return () => clearInterval(interval);
}, [config]);
```

### 样式设计

**固定定位：**
```css
position: fixed;
z-index: 50;
left: ${position.x}px;
top: ${position.y}px;
```

**渐变背景：**
```css
background: linear-gradient(to bottom right, 
  hsl(var(--primary) / 0.1), 
  hsl(var(--secondary) / 0.1)
);
backdrop-filter: blur(8px);
```

**对话气泡：**
```css
.bubble {
  background: hsl(var(--background) / 0.8);
  border-radius: 8px;
  padding: 12px;
  position: relative;
}

.bubble::after {
  content: '';
  position: absolute;
  bottom: -8px;
  left: 16px;
  border-left: 8px solid transparent;
  border-right: 8px solid transparent;
  border-top: 8px solid hsl(var(--background) / 0.8);
}
```

## 最佳实践

### 位置选择

**推荐位置：**
1. **右下角**：默认位置，不遮挡主要内容
2. **右上角**：适合需要频繁查看的用户
3. **左下角**：适合左撇子用户
4. **屏幕边缘**：最小化时放在边缘，节省空间

**避免位置：**
- 屏幕中央：会遮挡主要内容
- 导航栏上方：可能与菜单冲突
- 滚动条附近：可能误触

### 使用技巧

**提高效率：**
1. 学习时最小化浮窗，减少干扰
2. 休息时展开浮窗，查看鼓励
3. 有任务时保持展开，及时提醒
4. 根据屏幕大小调整位置

**个性化设置：**
1. 选择符合学习风格的性格
2. 根据时间段调整浮窗状态
3. 配合仪表盘秘书卡片使用
4. 定期更换形象和服装

### 性能优化

**资源占用：**
- 浮窗组件轻量级，占用资源极少
- 定时器每分钟只执行一次
- 不影响页面性能
- 可随时关闭

**电池友好：**
- 更新频率适中
- 不会频繁重绘
- 动画使用 CSS 实现
- 优化电池消耗

## 常见问题

### Q1: 浮窗可以调整大小吗？

A: 目前浮窗大小是固定的，但可以通过最小化功能缩小占用空间。未来版本会考虑添加大小调整功能。

### Q2: 浮窗会随页面滚动吗？

A: 不会。浮窗使用 `position: fixed` 固定定位，始终固定在屏幕上，不会随页面滚动。

### Q3: 可以同时显示多个浮窗吗？

A: 不可以。系统只会显示一个浮窗秘书，确保界面简洁不混乱。

### Q4: 浮窗会遮挡重要内容怎么办？

A: 可以拖动浮窗到其他位置，或者点击最小化按钮缩小为图标。

### Q5: 浮窗的消息可以手动刷新吗？

A: 目前消息每分钟自动更新。如需立即更新，可以刷新页面或重新保存配置。

### Q6: 浮窗在移动端可以使用吗？

A: 浮窗主要为桌面端设计。移动端建议使用仪表盘的秘书卡片功能。

### Q7: 浮窗会影响页面性能吗？

A: 不会。浮窗组件经过优化，资源占用极少，不会影响页面性能。

### Q8: 如何永久关闭浮窗？

A: 点击浮窗的关闭按钮，然后在设置页面关闭"启用学习秘书"开关。

## 未来规划

### 短期（1-2个月）

1. **大小调整**：支持拖动边缘调整浮窗大小
2. **透明度调整**：可以调整浮窗的透明度
3. **主题切换**：支持不同的浮窗主题样式
4. **快捷键**：使用快捷键快速显示/隐藏浮窗

### 中期（3-6个月）

1. **多浮窗**：支持同时显示多个浮窗（不同功能）
2. **浮窗组件**：可以添加其他组件到浮窗（如时钟、倒计时）
3. **动画效果**：秘书形象的动态展示
4. **语音播报**：浮窗消息支持语音播报

### 长期（6-12个月）

1. **智能定位**：根据使用习惯自动调整位置
2. **手势控制**：支持手势操作浮窗
3. **多屏支持**：在多显示器环境下智能分布
4. **AI 对话**：浮窗支持实时 AI 对话

## 总结

浮窗秘书是智学秘伴的创新功能，通过可拖动、可最小化的浮窗形式，让学习秘书随时随地陪伴你的学习。无论你在浏览哪个页面，秘书都会在屏幕上为你提供个性化的问候、提醒和鼓励。

**核心优势：**
- 🎯 智能定位和位置记忆
- 🔄 灵活的最小化/展开功能
- 💬 实时更新的对话内容
- 🎨 美观的视觉设计
- 👆 流畅的拖动体验
- ⏰ 智能的消息切换

**使用建议：**
- 根据学习场景调整浮窗状态
- 选择合适的位置不遮挡内容
- 配合仪表盘秘书卡片使用
- 定期更换秘书形象保持新鲜感

让浮窗秘书成为你学习路上最贴心的伙伴！

---

**智学秘伴团队**  
*让学习更有温度，让成长更有陪伴*
