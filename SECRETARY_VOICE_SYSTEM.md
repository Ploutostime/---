# 秘书语音功能说明

## 功能概述

秘书语音功能为智学秘伴添加了语音交互能力，让秘书能够发出声音，通过语音与用户进行互动，增强陪伴感和沉浸感。

## 核心特性

### 1. 语音合成技术

**Web Speech API**
- 使用浏览器内置的语音合成引擎
- 无需额外下载或安装
- 支持离线使用
- 响应速度快

**中文语音支持**
- 自动检测并选择中文语音
- 支持多种中文方言
- 优先使用高质量语音
- 自动回退到默认语音

### 2. 个性化语音配置

每个秘书都有独特的语音特征，通过音调和语速的差异化配置，营造不同的角色感：

#### 小萌（可爱萝莉）
- **音调**：1.8（高音调）
- **语速**：1.2（快语速）
- **风格**：可爱活泼，充满活力
- **特点**：声音甜美，语气轻快

#### 优雅姐姐（成熟御姐）
- **音调**：0.9（中低音调）
- **语速**：0.9（慢语速）
- **风格**：成熟优雅，从容不迫
- **特点**：声音磁性，语气沉稳

#### 温柔学姐
- **音调**：1.1（中音调）
- **语速**：1.0（正常语速）
- **风格**：温柔体贴，亲切自然
- **特点**：声音柔和，语气温暖

#### 稳重叔叔
- **音调**：0.7（低音调）
- **语速**：0.85（慢语速）
- **风格**：稳重成熟，值得信赖
- **特点**：声音浑厚，语气稳重

#### 霸道总裁
- **音调**：0.8（低音调）
- **语速**：1.0（正常语速）
- **风格**：霸气高冷，雷厉风行
- **特点**：声音低沉，语气果断

#### 阳光学长
- **音调**：1.0（中音调）
- **语速**：1.1（快语速）
- **风格**：阳光活力，积极向上
- **特点**：声音明朗，语气热情

### 3. 语音触发场景

#### 自动触发

**选择秘书时**
- 触发时机：点击选择秘书后
- 延迟时间：500ms
- 播放内容：问候语
- 目的：欢迎用户，建立第一印象

**切换服装时**
- 触发时机：选择新服装后
- 延迟时间：300ms
- 播放内容：评论语
- 目的：对服装进行评价，增加互动

**保存配置时**
- 触发时机：点击保存按钮成功后
- 延迟时间：立即
- 播放内容：鼓励语
- 目的：给予正面反馈，增强成就感

#### 手动触发

**播放问候语**
- 触发方式：点击"问候"按钮
- 播放内容：随机选择一句问候语
- 使用场景：想听秘书说话时

**语音控制**
- 暂停：暂停当前播放的语音
- 恢复：继续播放暂停的语音
- 停止：停止播放并清除语音队列

### 4. 语音内容类型

每个秘书都配置了4类语音内容，每类包含3-5句不同的话语：

#### 问候语（Greetings）
用于欢迎用户，建立亲切感

**小萌**：
- "主人好呀！小萌来陪你学习啦~"
- "嘿嘿，主人今天也要加油哦！"
- "小萌在这里等你很久了呢~"

**优雅姐姐**：
- "欢迎回来，今天也要努力学习哦。"
- "你好，我会陪伴你完成今天的学习任务。"
- "准备好开始了吗？让我们一起加油吧。"

**温柔学姐**：
- "你好呀，今天也要好好学习哦。"
- "欢迎回来，学姐会一直陪着你的。"
- "准备好了吗？让我们一起努力吧。"

#### 评论语（Comments）
用于对服装进行评价，增加换装互动

**小萌**：
- "哇！这套衣服好可爱呀~"
- "主人觉得这样好看吗？"
- "嘻嘻，小萌很喜欢这个呢！"

**优雅姐姐**：
- "这套装扮很适合我呢。"
- "你的品味不错。"
- "嗯，这样看起来很优雅。"

**温柔学姐**：
- "这套衣服很好看呢。"
- "嗯，很适合我。"
- "谢谢你为我挑选的衣服。"

#### 鼓励语（Encouragements）
用于激励用户，提升学习动力

**小萌**：
- "主人加油！你是最棒的！"
- "不要放弃哦，小萌相信你！"
- "再坚持一下，马上就成功了！"

**优雅姐姐**：
- "你做得很好，继续保持。"
- "相信自己，你一定可以的。"
- "不要着急，慢慢来就好。"

**温柔学姐**：
- "加油，你一定可以做到的。"
- "学姐相信你的能力。"
- "不要气馁，继续努力吧。"

#### 提醒语（Reminders）
用于学习提醒，帮助时间管理

**小萌**：
- "主人，该学习了哦~"
- "休息够了吗？我们继续吧！"
- "时间到啦，该完成任务了呢~"

**优雅姐姐**：
- "该学习了，不要偷懒哦。"
- "时间管理很重要，我们开始吧。"
- "休息结束了，该继续努力了。"

**温柔学姐**：
- "该学习了，不要拖延哦。"
- "时间到了，我们开始吧。"
- "休息够了，该继续学习了。"

## 使用方法

### 1. 访问秘书形象页面

在侧边栏导航中点击"秘书形象"，进入秘书换装系统。

### 2. 语音控制按钮

在秘书换装系统卡片的标题右侧，可以看到语音控制按钮组：

**语音开关**
- 图标：Volume2（开启）/ VolumeX（关闭）
- 功能：开启或关闭语音功能
- 状态：蓝色表示开启，灰色表示关闭

**问候按钮**
- 图标：Play
- 功能：播放秘书的问候语
- 状态：播放时禁用

**暂停/恢复按钮**
- 图标：Pause / Play
- 功能：暂停或恢复当前播放的语音
- 显示：仅在播放时显示

**停止按钮**
- 图标：VolumeX
- 功能：停止当前播放的语音
- 显示：仅在播放时显示

### 3. 自动语音播放

**选择秘书**
1. 在"选择秘书"标签中点击秘书卡片
2. 等待500ms后自动播放问候语
3. 听到秘书的欢迎语音

**切换服装**
1. 在"选择服装"标签中点击服装卡片
2. 等待300ms后自动播放评论语
3. 听到秘书对服装的评价

**保存配置**
1. 点击"保存配置"按钮
2. 保存成功后立即播放鼓励语
3. 听到秘书的鼓励和肯定

### 4. 手动控制语音

**播放问候语**
- 点击"问候"按钮
- 秘书会随机说一句问候语
- 可以多次点击听不同的问候语

**暂停语音**
- 在语音播放时点击"暂停"按钮
- 语音会暂停在当前位置
- 可以点击"恢复"继续播放

**停止语音**
- 在语音播放时点击"停止"按钮
- 语音会立即停止
- 清除语音队列

**关闭语音**
- 点击语音开关按钮
- 所有自动语音将不再播放
- 手动播放按钮也会禁用

## 技术实现

### VoiceManager 类

语音管理工具类，封装了 Web Speech API 的所有功能。

**主要方法**：

```typescript
// 播放语音
speak(text: string, options?: {
  pitch?: number;
  rate?: number;
  volume?: number;
  voice?: SpeechSynthesisVoice | null;
  onEnd?: () => void;
  onError?: (error: SpeechSynthesisErrorEvent) => void;
})

// 停止语音
stop()

// 暂停语音
pause()

// 恢复语音
resume()

// 检查是否正在播放
isSpeaking(): boolean

// 检查是否暂停
isPaused(): boolean

// 获取所有可用语音
getAvailableVoices(): SpeechSynthesisVoice[]
```

### VoiceControl 组件

语音控制组件，提供用户界面。

**Props**：
```typescript
interface VoiceControlProps {
  secretaryType: string;  // 秘书类型
  className?: string;     // 自定义样式
  showText?: boolean;     // 是否显示按钮文字
}
```

**功能**：
- 语音开关控制
- 播放问候语
- 暂停/恢复控制
- 停止控制
- 实时状态显示

### 语音配置

每个秘书的语音配置存储在 `secretaryVoiceConfigs` 对象中：

```typescript
export const secretaryVoiceConfigs: Record<string, SecretaryVoiceConfig> = {
  loli: {
    pitch: 1.8,
    rate: 1.2,
    volume: 1,
    greetings: [...],
    comments: [...],
    encouragements: [...],
    reminders: [...],
  },
  // 其他秘书配置...
};
```

### 自动触发逻辑

使用 React 的 `useEffect` 钩子实现自动触发：

```typescript
// 选择秘书时播放问候语
useEffect(() => {
  if (selectedSecretary) {
    const timer = setTimeout(() => {
      playSecretaryVoice('greeting');
    }, 500);
    return () => clearTimeout(timer);
  }
}, [selectedSecretary?.id]);

// 切换服装时播放评论
useEffect(() => {
  if (selectedOutfitId && availableOutfits.length > 0) {
    const timer = setTimeout(() => {
      playSecretaryVoice('comment');
    }, 300);
    return () => clearTimeout(timer);
  }
}, [selectedOutfitId]);
```

## 浏览器兼容性

### 支持的浏览器

| 浏览器 | 版本 | 支持程度 |
|--------|------|----------|
| Chrome | 33+ | ✅ 完全支持 |
| Edge | 14+ | ✅ 完全支持 |
| Firefox | 49+ | ✅ 完全支持 |
| Safari | 7+ | ✅ 完全支持 |
| Opera | 21+ | ✅ 完全支持 |

### 语音质量

不同浏览器的语音质量可能有所差异：

- **Chrome/Edge**：使用 Google 语音引擎，质量较高
- **Firefox**：使用系统语音引擎，质量中等
- **Safari**：使用 Apple 语音引擎，质量较高

### 降级方案

如果浏览器不支持 Web Speech API：
- 语音功能自动禁用
- 不影响其他功能的使用
- 用户体验优雅降级

## 使用建议

### 最佳实践

1. **首次使用**
   - 确保浏览器允许网站播放声音
   - 调整系统音量到合适大小
   - 选择喜欢的秘书角色

2. **日常使用**
   - 根据环境决定是否开启语音
   - 在安静环境中使用效果更好
   - 可以随时关闭语音功能

3. **学习场景**
   - 开始学习前听秘书的问候
   - 完成任务后听秘书的鼓励
   - 需要提醒时让秘书督促

### 注意事项

1. **音量控制**
   - 首次使用时建议调低音量
   - 避免在公共场合大声播放
   - 可以使用耳机获得更好体验

2. **网络环境**
   - 语音合成在本地进行，无需网络
   - 首次加载页面需要网络连接
   - 离线状态下语音功能仍可用

3. **性能影响**
   - 语音合成对性能影响很小
   - 不会影响其他功能的使用
   - 可以放心长时间使用

## 扩展功能

### 未来计划

1. **更多语音内容**
   - 增加每个秘书的语音库
   - 添加更多场景的语音
   - 支持节日特殊语音

2. **自定义语音**
   - 允许用户自定义语音文本
   - 支持导入自定义语音
   - 提供语音编辑器

3. **高级功能**
   - 集成高质量 TTS 服务
   - 支持多语言语音
   - 添加语音情感识别
   - 实现语音对话功能

4. **智能提醒**
   - 定时播放提醒语
   - 根据学习状态自动提醒
   - 智能调整提醒频率

## 常见问题

### Q: 为什么听不到声音？

A: 请检查以下几点：
1. 浏览器是否允许网站播放声音
2. 系统音量是否打开
3. 语音功能是否开启（检查语音开关按钮）
4. 浏览器是否支持 Web Speech API

### Q: 语音听起来不自然怎么办？

A: 这是浏览器内置语音引擎的限制。可以尝试：
1. 更换浏览器（Chrome 和 Safari 的语音质量较好）
2. 等待未来版本集成高质量 TTS 服务
3. 调整语速和音调（未来功能）

### Q: 可以更换语音吗？

A: 当前版本自动选择最佳中文语音。未来版本将支持：
1. 手动选择语音
2. 自定义语音参数
3. 导入第三方语音

### Q: 语音会消耗流量吗？

A: 不会。语音合成完全在本地进行，不需要网络连接，不会消耗任何流量。

### Q: 可以关闭自动播放吗？

A: 可以。点击语音开关按钮关闭语音功能，所有自动播放都会停止。

## 总结

秘书语音功能为智学秘伴增添了生动的语音交互，让学习陪伴更加真实和温暖。通过个性化的语音配置和丰富的语音内容，每个秘书都有独特的声音和说话风格，为用户提供更加沉浸的学习体验。

无论是温柔的问候、贴心的提醒，还是真诚的鼓励，秘书的声音都会陪伴你度过每一个学习时光。
